<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Minecraft Totem Converter</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            text-align: center;
        }
        .container {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #output-canvas {
            width: 128px; /* Scale up for better viewing */
            height: 128px;
            image-rendering: pixelated;
            border: 2px solid #333;
            margin: 20px 0;
            display: none; /* Hide until an image is converted */
        }
        #download-btn {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            display: none; /* Hide until an image is converted */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Minecraft Totem Converter</h1>
        <p>Upload a Minecraft skin PNG.</p>
        <input type="file" id="imageLoader" accept="image/png">
        <canvas id="myCanvas" style="display:none;"></canvas>
        <canvas id="Totem" style="display:none;"></canvas>
        <canvas id="output-canvas"></canvas>
        <button id="download-btn">Download Totem</button>
    </div>

    <script>
        // The core conversion logic, copied 1:1 from your JS
        function test(img) {
            const c = document.getElementById("myCanvas");
            const ctx = c.getContext("2d");
            const d = document.getElementById("Totem");
            const dtx = d.getContext("2d");
            
            // Get the new output canvas
            const outputCanvas = document.getElementById("output-canvas");
            const outputCtx = outputCanvas.getContext("2d");

            const downloadBtn = document.getElementById("download-btn");
            
            dtx.clearRect(0, 0, 16, 16);
            dtx.drawImage(c, 8, 8, 8, 8, 4, 1, 8, 8);
            dtx.clearRect(4, 1, 1, 1);
            dtx.clearRect(11, 1, 1, 1);
        
            dtx.drawImage(c, 20, 21, 8, 1, 4, 9, 8, 1);
            dtx.drawImage(c, 20, 23, 8, 1, 4, 10, 8, 1);
            dtx.drawImage(c, 20, 29, 8, 1, 4, 11, 8, 1);
            dtx.drawImage(c, 20, 31, 8, 1, 4, 12, 8, 1);
        
            dtx.drawImage(c, 5, 20, 3, 2, 5, 13, 3, 2);
            dtx.drawImage(c, 6, 31, 2, 1, 6, 15, 2, 1);
        
            if (img.height > 32) {
                dtx.drawImage(c, 20, 52, 3, 2, 8, 13, 3, 2);
                dtx.drawImage(c, 20, 63, 2, 1, 8, 15, 2, 1);
            } else {
                dtx.drawImage(c, 7, 20, 3, 2, 8, 13, 3, 2);
                dtx.drawImage(c, 7, 31, 2, 1, 8, 15, 2, 1);
            }
        
            dtx.drawImage(c, 44, 20, 1, 1, 3, 8, 1, 1);
            dtx.drawImage(c, 45, 20, 1, 1, 3, 9, 1, 1);
            dtx.drawImage(c, 46, 20, 1, 1, 3, 10, 1, 1);
            dtx.drawImage(c, 44, 21, 1, 1, 2, 8, 1, 1);
            dtx.drawImage(c, 45, 21, 1, 1, 2, 9, 1, 1);
            dtx.drawImage(c, 46, 21, 1, 1, 2, 10, 1, 1);
            dtx.drawImage(c, 44, 31, 1, 1, 1, 8, 1, 1);
            dtx.drawImage(c, 45, 31, 1, 1, 1, 9, 1, 1);
            dtx.fillStyle = "rgba(255, 0, 0, 0.005)";
            dtx.fillRect(10, 15, 1, 1);
        
            if (img.height > 32) {
                dtx.drawImage(c, 39, 52, 1, 1, 12, 8, 1, 1);
                dtx.drawImage(c, 38, 52, 1, 1, 12, 9, 1, 1);
                dtx.drawImage(c, 37, 52, 1, 1, 12, 10, 1, 1);
                dtx.drawImage(c, 39, 53, 1, 1, 13, 8, 1, 1);
                dtx.drawImage(c, 38, 53, 1, 1, 13, 9, 1, 1);
                dtx.drawImage(c, 37, 53, 1, 1, 13, 10, 1, 1);
                dtx.drawImage(c, 37, 63, 1, 1, 14, 8, 1, 1);
                dtx.drawImage(c, 38, 63, 1, 1, 14, 9, 1, 1);
            } else {
                dtx.drawImage(c, 44, 20, 1, 1, 12, 8, 1, 1);
                dtx.drawImage(c, 45, 20, 1, 1, 12, 9, 1, 1);
                dtx.drawImage(c, 46, 20, 1, 1, 12, 10, 1, 1);
                dtx.drawImage(c, 44, 21, 1, 1, 13, 8, 1, 1);
                dtx.drawImage(c, 45, 21, 1, 1, 13, 9, 1, 1);
                dtx.drawImage(c, 46, 21, 1, 1, 13, 10, 1, 1);
                dtx.drawImage(c, 46, 31, 1, 1, 14, 8, 1, 1);
                dtx.drawImage(c, 45, 31, 1, 1, 14, 9, 1, 1);
            }
        
            if (img.height > 32) {
                dtx.drawImage(c, 40, 8, 8, 8, 4, 1, 8, 8); // Head overlay
                dtx.drawImage(c, 44, 36, 1, 1, 3, 8, 1, 1);
                dtx.drawImage(c, 45, 36, 1, 1, 3, 9, 1, 1);
                dtx.drawImage(c, 46, 36, 1, 1, 3, 10, 1, 1);
                dtx.drawImage(c, 44, 37, 1, 1, 2, 8, 1, 1);
                dtx.drawImage(c, 45, 37, 1, 1, 2, 9, 1, 1);
                dtx.drawImage(c, 46, 37, 1, 1, 2, 10, 1, 1);
                dtx.drawImage(c, 44, 47, 1, 1, 1, 8, 1, 1);
                dtx.drawImage(c, 45, 47, 1, 1, 1, 9, 1, 1);
                dtx.drawImage(c, 55, 52, 1, 1, 12, 8, 1, 1);
                dtx.drawImage(c, 54, 52, 1, 1, 12, 9, 1, 1);
                dtx.drawImage(c, 53, 52, 1, 1, 12, 10, 1, 1);
                dtx.drawImage(c, 55, 53, 1, 1, 13, 8, 1, 1);
                dtx.drawImage(c, 54, 53, 1, 1, 13, 9, 1, 1);
                dtx.drawImage(c, 53, 53, 1, 1, 13, 10, 1, 1);
                dtx.drawImage(c, 53, 63, 1, 1, 14, 8, 1, 1);
                dtx.drawImage(c, 54, 63, 1, 1, 14, 9, 1, 1);
                dtx.drawImage(c, 20, 37, 8, 1, 4, 9, 8, 1);
                dtx.drawImage(c, 20, 39, 8, 1, 4, 10, 8, 1);
                dtx.drawImage(c, 20, 45, 8, 1, 4, 11, 8, 1);
                dtx.drawImage(c, 20, 47, 8, 1, 4, 12, 8, 1);
                dtx.drawImage(c, 5, 36, 3, 2, 5, 13, 3, 2);
                dtx.drawImage(c, 6, 47, 2, 1, 6, 15, 2, 1);
                dtx.drawImage(c, 4, 52, 3, 2, 8, 13, 3, 2);
                dtx.drawImage(c, 4, 63, 2, 1, 8, 15, 2, 1);
            }
            
            // Draw the completed totem from the 16x16 canvas 'd' onto the output canvas
            outputCanvas.width = 16;
            outputCanvas.height = 16;
            outputCtx.drawImage(d, 0, 0);

            outputCanvas.style.display = 'block';
            downloadBtn.style.display = 'block';
        }

        document.getElementById('imageLoader').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const c = document.getElementById("myCanvas");
                    const ctx = c.getContext("2d");
                    c.width = img.width;
                    c.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    test(img);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        document.getElementById('download-btn').addEventListener('click', function() {
            const outputCanvas = document.getElementById("output-canvas");
            const link = document.createElement('a');
            link.href = outputCanvas.toDataURL('image/png');
            link.download = 'totem.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    </script>
</body>
</html>
