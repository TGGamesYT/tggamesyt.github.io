<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Totem Pack Creator</title>
    <style>
    /* Import Minecraft font */
    @font-face {
        font-family: "MinecraftSeven";
        src: url("https://tggamesyt.dev/assets/Minecraft-Seven_v2.ttf") format("truetype");
        font-weight: normal;
        font-style: normal;
    }

    /* Reset + Base */
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: "MinecraftSeven", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: #121212;
        color: #eaeaea;
        text-align: center;
        padding: 1rem;
    }

    h1 {
        font-size: clamp(1.5rem, 2.5vw, 2.5rem);
        margin-bottom: 0.5rem;
        color: #ffffff;
        letter-spacing: 1px;
    }

    p {
        margin: 0.5rem 0 1rem 0;
        color: #b3b3b3;
        font-size: 1rem;
    }

    .container {
        background: #1e1e1e;
        padding: 2rem;
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        width: 100%;
        max-width: 500px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .input-group {
        margin-bottom: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        width: 100%;
    }

    input[type="text"],
    input[type="file"] {
        padding: 0.75rem;
        border-radius: 8px;
        border: 2px solid #444;
        background: #2a2a2a;
        color: #fff;
        font-size: 1rem;
        width: 100%;
    }

    input::placeholder {
        color: #aaa;
    }

    button {
        padding: 0.75rem 1.25rem;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        border: none;
        border-radius: 10px;
        background: linear-gradient(135deg, #4cafef, #3b82f6);
        color: white;
        transition: transform 0.15s ease, background 0.3s ease;
        width: 100%;
        max-width: 250px;
    }

    button:hover {
        transform: translateY(-2px);
        background: linear-gradient(135deg, #60a5fa, #2563eb);
    }

    #output-canvas {
        width: 128px;
        height: 128px;
        image-rendering: pixelated;
        border: 2px solid #444;
        border-radius: 8px;
        margin: 1.5rem 0;
        display: none;
    }

    #pack-download-btn,
    #image-download-btn {
        display: none;
    }

    /* Responsive */
    @media (min-width: 769px) {
        .button-row {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            width: 100%;
        }
    }

    @media (max-width: 768px) {
        .container {
            padding: 1.25rem;
        }

        h1 {
            font-size: 1.75rem;
        }
    }

    @media (max-width: 480px) {
        button {
            font-size: 0.9rem;
            padding: 0.65rem 1rem;
        }
    }
    </style>
</head>
<body>
    <div class="container">
        <h1>Minecraft Totem Pack Creator</h1>
        <p>Enter a username or upload a skin file.</p>
        
        <div class="input-group">
            <input type="text" id="username-input" placeholder="Enter Minecraft Username">
            <button onclick="fetchSkin()">Fetch Skin</button>
        </div>
        
        <p>OR</p>

        <div class="input-group">
            <input type="file" id="imageLoader" accept="image/png">
        </div>

        <canvas id="myCanvas" style="display:none;"></canvas>
        <canvas id="Totem" style="display:none;"></canvas>
        <canvas id="output-canvas" width="16" height="16"></canvas>

        <button id="image-download-btn">Download Totem Image</button>
        <button id="pack-download-btn">Download as Resource Pack</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <script>
        // Core conversion logic
        function test(img) {
            const c = document.getElementById("myCanvas");
            const ctx = c.getContext("2d");
            const d = document.getElementById("Totem");
            const dtx = d.getContext("2d");
            const outputCanvas = document.getElementById("output-canvas");
            const outputCtx = outputCanvas.getContext("2d");
        
            dtx.clearRect(0, 0, 16, 16);
            dtx.drawImage(c, 8, 8, 8, 8, 4, 1, 8, 8);
            dtx.clearRect(4, 1, 1, 1);
            dtx.clearRect(11, 1, 1, 1);
        
            dtx.drawImage(c, 20, 21, 8, 1, 4, 9, 8, 1);
            dtx.drawImage(c, 20, 23, 8, 1, 4, 10, 8, 1);
            dtx.drawImage(c, 20, 29, 8, 1, 4, 11, 8, 1);
            dtx.drawImage(c, 20, 31, 8, 1, 4, 12, 8, 1);
        
            dtx.drawImage(c, 5, 20, 3, 2, 5, 13, 3, 2);
            dtx.drawImage(c, 6, 31, 2, 1, 6, 15, 2, 1);
        
            if (img.height > 32) {
                dtx.drawImage(c, 20, 52, 3, 2, 8, 13, 3, 2);
                dtx.drawImage(c, 20, 63, 2, 1, 8, 15, 2, 1);
            } else {
                dtx.drawImage(c, 7, 20, 3, 2, 8, 13, 3, 2);
                dtx.drawImage(c, 7, 31, 2, 1, 8, 15, 2, 1);
            }
        
            dtx.drawImage(c, 44, 20, 1, 1, 3, 8, 1, 1);
            dtx.drawImage(c, 45, 20, 1, 1, 3, 9, 1, 1);
            dtx.drawImage(c, 46, 20, 1, 1, 3, 10, 1, 1);
            dtx.drawImage(c, 44, 21, 1, 1, 2, 8, 1, 1);
            dtx.drawImage(c, 45, 21, 1, 1, 2, 9, 1, 1);
            dtx.drawImage(c, 46, 21, 1, 1, 2, 10, 1, 1);
            dtx.drawImage(c, 44, 31, 1, 1, 1, 8, 1, 1);
            dtx.drawImage(c, 45, 31, 1, 1, 1, 9, 1, 1);
            dtx.fillStyle = "rgba(255, 0, 0, 0.005)";
            dtx.fillRect(10, 15, 1, 1);
        
            if (img.height > 32) {
                dtx.drawImage(c, 39, 52, 1, 1, 12, 8, 1, 1);
                dtx.drawImage(c, 38, 52, 1, 1, 12, 9, 1, 1);
                dtx.drawImage(c, 37, 52, 1, 1, 12, 10, 1, 1);
                dtx.drawImage(c, 39, 53, 1, 1, 13, 8, 1, 1);
                dtx.drawImage(c, 38, 53, 1, 1, 13, 9, 1, 1);
                dtx.drawImage(c, 37, 53, 1, 1, 13, 10, 1, 1);
                dtx.drawImage(c, 37, 63, 1, 1, 14, 8, 1, 1);
                dtx.drawImage(c, 38, 63, 1, 1, 14, 9, 1, 1);
            } else {
                dtx.drawImage(c, 44, 20, 1, 1, 12, 8, 1, 1);
                dtx.drawImage(c, 45, 20, 1, 1, 12, 9, 1, 1);
                dtx.drawImage(c, 46, 20, 1, 1, 12, 10, 1, 1);
                dtx.drawImage(c, 44, 21, 1, 1, 13, 8, 1, 1);
                dtx.drawImage(c, 45, 21, 1, 1, 13, 9, 1, 1);
                dtx.drawImage(c, 46, 21, 1, 1, 13, 10, 1, 1);
                dtx.drawImage(c, 46, 31, 1, 1, 14, 8, 1, 1);
                dtx.drawImage(c, 45, 31, 1, 1, 14, 9, 1, 1);
            }
        
            // Draw head overlay
            dtx.drawImage(c, 40, 8, 8, 8, 4, 1, 8, 8);
            if (img.height > 32) {
                dtx.drawImage(c, 44, 36, 1, 1, 3, 8, 1, 1);
                dtx.drawImage(c, 45, 36, 1, 1, 3, 9, 1, 1);
                dtx.drawImage(c, 46, 36, 1, 1, 3, 10, 1, 1);
                dtx.drawImage(c, 44, 37, 1, 1, 2, 8, 1, 1);
                dtx.drawImage(c, 45, 37, 1, 1, 2, 9, 1, 1);
                dtx.drawImage(c, 46, 37, 1, 1, 2, 10, 1, 1);
                dtx.drawImage(c, 44, 47, 1, 1, 1, 8, 1, 1);
                dtx.drawImage(c, 45, 47, 1, 1, 1, 9, 1, 1);
                dtx.drawImage(c, 55, 52, 1, 1, 12, 8, 1, 1);
                dtx.drawImage(c, 54, 52, 1, 1, 12, 9, 1, 1);
                dtx.drawImage(c, 53, 52, 1, 1, 12, 10, 1, 1);
                dtx.drawImage(c, 55, 53, 1, 1, 13, 8, 1, 1);
                dtx.drawImage(c, 54, 53, 1, 1, 13, 9, 1, 1);
                dtx.drawImage(c, 53, 53, 1, 1, 13, 10, 1, 1);
                dtx.drawImage(c, 53, 63, 1, 1, 14, 8, 1, 1);
                dtx.drawImage(c, 54, 63, 1, 1, 14, 9, 1, 1);
                dtx.drawImage(c, 20, 37, 8, 1, 4, 9, 8, 1);
                dtx.drawImage(c, 20, 39, 8, 1, 4, 10, 8, 1);
                dtx.drawImage(c, 20, 45, 8, 1, 4, 11, 8, 1);
                dtx.drawImage(c, 20, 47, 8, 1, 4, 12, 8, 1);
                dtx.drawImage(c, 5, 36, 3, 2, 5, 13, 3, 2);
                dtx.drawImage(c, 6, 47, 2, 1, 6, 15, 2, 1);
                dtx.drawImage(c, 4, 52, 3, 2, 8, 13, 3, 2);
                dtx.drawImage(c, 4, 63, 2, 1, 8, 15, 2, 1);
            }
        
            outputCtx.drawImage(d, 0, 0);
            outputCanvas.style.display = 'block';
            document.getElementById('image-download-btn').style.display = 'block';
            document.getElementById('pack-download-btn').style.display = 'block';
        }

        // Handle skin file upload
        document.getElementById('imageLoader').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const c = document.getElementById("myCanvas");
                    c.width = img.width;
                    c.height = img.height;
                    c.getContext("2d").drawImage(img, 0, 0);
                    test(img);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        // Fetch skin by username
        function fetchSkin() {
            const username = document.getElementById('username-input').value;
            if (!username) {
                alert("Please enter a Minecraft username.");
                return;
            }
            const img = new Image();
            img.onload = function() {
                const c = document.getElementById("myCanvas");
                c.width = img.width;
                c.height = img.height;
                c.getContext("2d").drawImage(img, 0, 0);
                test(img);
            };
            img.onerror = function() {
                alert("Could not find a skin for that username.");
            };
            // Use Minotar for direct skin image URL
            img.src = `https://minotar.net/skin/${username}`;
            img.crossOrigin = "anonymous";
        }

        // Download totem as a single image
        document.getElementById('image-download-btn').addEventListener('click', function() {
            const outputCanvas = document.getElementById("output-canvas");
            const link = document.createElement('a');
            link.href = outputCanvas.toDataURL('image/png');
            link.download = 'totem.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Download as a resource pack
        document.getElementById('pack-download-btn').addEventListener('click', function() {
            const outputCanvas = document.getElementById("output-canvas");
            const totemDataURL = outputCanvas.toDataURL('image/png');
            const username = document.getElementById('username-input').value || "Custom";
            
            const zip = new JSZip();
            
            // pack.mcmeta file
            const packMcmeta = {
                "pack": {
                    "pack_format": 1,
                    "supported_formats": { "min_inclusive": 1, "max_inclusive": 100 },
                    "description": "§7Custom Java §cTotem of Undying§7 Pack!"
                }
            };
            zip.file("pack.mcmeta", JSON.stringify(packMcmeta, null, 4));
            
            // pack.png file (using the totem image)
            zip.file("pack.png", totemDataURL.substr(totemDataURL.indexOf(',') + 1), { base64: true });
            
            // totem of undying texture
            const texturesFolder = zip.folder("assets/minecraft/textures/item");
            texturesFolder.file("totem_of_undying.png", totemDataURL.substr(totemDataURL.indexOf(',') + 1), { base64: true });
            
            // Generate and download the zip file
            zip.generateAsync({ type: "blob" }).then(function(content) {
                saveAs(content, `${username}-Totem.zip`);
            });
        });
    </script>
</body>
</html>
