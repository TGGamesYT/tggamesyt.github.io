<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Skin → Totem Converter</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    #canvasImg { image-rendering: pixelated; border: 2px solid #ccc; margin-top: 10px; }
    #downloadBtn { margin-top: 15px; padding: 10px 20px; }
  </style>
</head>
<body>
  <h2>Minecraft Skin → Totem Converter</h2>
  <input type="file" id="imageLoader" accept="image/png"><br>
  <canvas id="myCanvas" style="display:none;"></canvas>
  <canvas id="Totem" width="16" height="16" style="display:none;"></canvas>
  <br>
  <img id="canvasImg" width="128" height="128" alt="Totem preview">
  <br>
  <button id="downloadBtn" disabled>Download Totem PNG</button>

  <script>
    const c = document.getElementById("myCanvas");
    const ctx = c.getContext("2d");
    const d = document.getElementById("Totem");
    const dtx = d.getContext("2d");
    const imgPreview = document.getElementById("canvasImg");
    let imagefile;

    document.getElementById("imageLoader").addEventListener("change", handleImage);
    document.getElementById("downloadBtn").addEventListener("click", () => {
      const a = document.createElement("a");
      a.href = d.toDataURL("image/png");
      a.download = "custom_totem.png";
      a.click();
    });

    function handleImage(e) {
      const reader = new FileReader();
      reader.onload = function (event) {
        const img = new Image();
        img.onload = function () {
          c.width = img.width;
          c.height = img.height;
          ctx.drawImage(img, 0, 0);
          test(img);
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    }

    function test(img) {
      const c = document.getElementById("myCanvas");
      const ctx = c.getContext("2d");

      dtx.clearRect(0, 0, 16, 16);

      // Base face
      dtx.drawImage(c, 8, 8, 8, 8, 4, 1, 8, 8);
      dtx.clearRect(4, 1, 1, 1);
      dtx.clearRect(11, 1, 1, 1);

      // Body shading
      dtx.drawImage(c, 20, 21, 8, 1, 4, 9, 8, 1);
      dtx.drawImage(c, 20, 23, 8, 1, 4, 10, 8, 1);
      dtx.drawImage(c, 20, 29, 8, 1, 4, 11, 8, 1);
      dtx.drawImage(c, 20, 31, 8, 1, 4, 12, 8, 1);

      // Arms (simplified)
      dtx.drawImage(c, 5, 20, 3, 2, 5, 13, 3, 2);
      dtx.drawImage(c, 6, 31, 2, 1, 6, 15, 2, 1);

      if (img.height > 32) {
        dtx.drawImage(c, 20, 52, 3, 2, 8, 13, 3, 2);
        dtx.drawImage(c, 20, 63, 2, 1, 8, 15, 2, 1);
      } else {
        dtx.drawImage(c, 7, 20, 3, 2, 8, 13, 3, 2);
        dtx.drawImage(c, 7, 31, 2, 1, 8, 15, 2, 1);
      }

      // Eyes
      dtx.drawImage(c, 44, 20, 1, 1, 3, 8, 1, 1);
      dtx.drawImage(c, 45, 20, 1, 1, 3, 9, 1, 1);
      dtx.drawImage(c, 46, 20, 1, 1, 3, 10, 1, 1);
      dtx.drawImage(c, 44, 21, 1, 1, 2, 8, 1, 1);
      dtx.drawImage(c, 45, 21, 1, 1, 2, 9, 1, 1);
      dtx.drawImage(c, 46, 21, 1, 1, 2, 10, 1, 1);

      imgPreview.src = d.toDataURL();
      document.getElementById("downloadBtn").disabled = false;
    }
  </script>
</body>
</html>
