<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Totem Pack Creator</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            text-align: center;
        }
        .container {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .input-group {
            margin-bottom: 15px;
        }
        #output-canvas {
            width: 128px;
            height: 128px;
            image-rendering: pixelated;
            border: 2px solid #333;
            margin: 20px 0;
            display: none;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        #pack-download-btn, #image-download-btn {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Minecraft Totem Pack Creator</h1>
        <p>Enter a username or upload a skin file.</p>
        
        <div class="input-group">
            <input type="text" id="username-input" placeholder="Enter Minecraft Username">
            <button onclick="fetchSkin()">Fetch Skin</button>
        </div>
        
        <p>OR</p>

        <div class="input-group">
            <input type="file" id="imageLoader" accept="image/png">
        </div>

        <canvas id="myCanvas" style="display:none;"></canvas>
        <canvas id="Totem" style="display:none;"></canvas>
        <canvas id="output-canvas" width="16" height="16"></canvas>

        <button id="image-download-btn">Download Totem Image</button>
        <button id="pack-download-btn">Download as Resource Pack</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <script>
        // Core conversion logic
        function test(img) {
            const c = document.getElementById("myCanvas");
            const ctx = c.getContext("2d");
            const d = document.getElementById("Totem");
            const dtx = d.getContext("2d");
            const outputCanvas = document.getElementById("output-canvas");
            const outputCtx = outputCanvas.getContext("2d");
        
            dtx.clearRect(0, 0, 16, 16);
            dtx.drawImage(c, 8, 8, 8, 8, 4, 1, 8, 8);
            dtx.clearRect(4, 1, 1, 1);
            dtx.clearRect(11, 1, 1, 1);
        
            dtx.drawImage(c, 20, 21, 8, 1, 4, 9, 8, 1);
            dtx.drawImage(c, 20, 23, 8, 1, 4, 10, 8, 1);
            dtx.drawImage(c, 20, 29, 8, 1, 4, 11, 8, 1);
            dtx.drawImage(c, 20, 31, 8, 1, 4, 12, 8, 1);
        
            dtx.drawImage(c, 5, 20, 3, 2, 5, 13, 3, 2);
            dtx.drawImage(c, 6, 31, 2, 1, 6, 15, 2, 1);
        
            if (img.height > 32) {
                dtx.drawImage(c, 20, 52, 3, 2, 8, 13, 3, 2);
                dtx.drawImage(c, 20, 63, 2, 1, 8, 15, 2, 1);
            } else {
                dtx.drawImage(c, 7, 20, 3, 2, 8, 13, 3, 2);
                dtx.drawImage(c, 7, 31, 2, 1, 8, 15, 2, 1);
            }
        
            dtx.drawImage(c, 44, 20, 1, 1, 3, 8, 1, 1);
            dtx.drawImage(c, 45, 20, 1, 1, 3, 9, 1, 1);
            dtx.drawImage(c, 46, 20, 1, 1, 3, 10, 1, 1);
            dtx.drawImage(c, 44, 21, 1, 1, 2, 8, 1, 1);
            dtx.drawImage(c, 45, 21, 1, 1, 2, 9, 1, 1);
            dtx.drawImage(c, 46, 21, 1, 1, 2, 10, 1, 1);
            dtx.drawImage(c, 44, 31, 1, 1, 1, 8, 1, 1);
            dtx.drawImage(c, 45, 31, 1, 1, 1, 9, 1, 1);
            dtx.fillStyle = "rgba(255, 0, 0, 0.005)";
            dtx.fillRect(10, 15, 1, 1);
        
            if (img.height > 32) {
                dtx.drawImage(c, 39, 52, 1, 1, 12, 8, 1, 1);
                dtx.drawImage(c, 38, 52, 1, 1, 12, 9, 1, 1);
                dtx.drawImage(c, 37, 52, 1, 1, 12, 10, 1, 1);
                dtx.drawImage(c, 39, 53, 1, 1, 13, 8, 1, 1);
                dtx.drawImage(c, 38, 53, 1, 1, 13, 9, 1, 1);
                dtx.drawImage(c, 37, 53, 1, 1, 13, 10, 1, 1);
                dtx.drawImage(c, 37, 63, 1, 1, 14, 8, 1, 1);
                dtx.drawImage(c, 38, 63, 1, 1, 14, 9, 1, 1);
            } else {
                dtx.drawImage(c, 44, 20, 1, 1, 12, 8, 1, 1);
                dtx.drawImage(c, 45, 20, 1, 1, 12, 9, 1, 1);
                dtx.drawImage(c, 46, 20, 1, 1, 12, 10, 1, 1);
                dtx.drawImage(c, 44, 21, 1, 1, 13, 8, 1, 1);
                dtx.drawImage(c, 45, 21, 1, 1, 13, 9, 1, 1);
                dtx.drawImage(c, 46, 21, 1, 1, 13, 10, 1, 1);
                dtx.drawImage(c, 46, 31, 1, 1, 14, 8, 1, 1);
                dtx.drawImage(c, 45, 31, 1, 1, 14, 9, 1, 1);
            }
        
            // Draw head overlay
            dtx.drawImage(c, 40, 8, 8, 8, 4, 1, 8, 8);
            if (img.height > 32) {
                dtx.drawImage(c, 44, 36, 1, 1, 3, 8, 1, 1);
                dtx.drawImage(c, 45, 36, 1, 1, 3, 9, 1, 1);
                dtx.drawImage(c, 46, 36, 1, 1, 3, 10, 1, 1);
                dtx.drawImage(c, 44, 37, 1, 1, 2, 8, 1, 1);
                dtx.drawImage(c, 45, 37, 1, 1, 2, 9, 1, 1);
                dtx.drawImage(c, 46, 37, 1, 1, 2, 10, 1, 1);
                dtx.drawImage(c, 44, 47, 1, 1, 1, 8, 1, 1);
                dtx.drawImage(c, 45, 47, 1, 1, 1, 9, 1, 1);
                dtx.drawImage(c, 55, 52, 1, 1, 12, 8, 1, 1);
                dtx.drawImage(c, 54, 52, 1, 1, 12, 9, 1, 1);
                dtx.drawImage(c, 53, 52, 1, 1, 12, 10, 1, 1);
                dtx.drawImage(c, 55, 53, 1, 1, 13, 8, 1, 1);
                dtx.drawImage(c, 54, 53, 1, 1, 13, 9, 1, 1);
                dtx.drawImage(c, 53, 53, 1, 1, 13, 10, 1, 1);
                dtx.drawImage(c, 53, 63, 1, 1, 14, 8, 1, 1);
                dtx.drawImage(c, 54, 63, 1, 1, 14, 9, 1, 1);
                dtx.drawImage(c, 20, 37, 8, 1, 4, 9, 8, 1);
                dtx.drawImage(c, 20, 39, 8, 1, 4, 10, 8, 1);
                dtx.drawImage(c, 20, 45, 8, 1, 4, 11, 8, 1);
                dtx.drawImage(c, 20, 47, 8, 1, 4, 12, 8, 1);
                dtx.drawImage(c, 5, 36, 3, 2, 5, 13, 3, 2);
                dtx.drawImage(c, 6, 47, 2, 1, 6, 15, 2, 1);
                dtx.drawImage(c, 4, 52, 3, 2, 8, 13, 3, 2);
                dtx.drawImage(c, 4, 63, 2, 1, 8, 15, 2, 1);
            }
        
            outputCtx.drawImage(d, 0, 0);
            outputCanvas.style.display = 'block';
            document.getElementById('image-download-btn').style.display = 'block';
            document.getElementById('pack-download-btn').style.display = 'block';
        }

        // Handle skin file upload
        document.getElementById('imageLoader').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const c = document.getElementById("myCanvas");
                    c.width = img.width;
                    c.height = img.height;
                    c.getContext("2d").drawImage(img, 0, 0);
                    test(img);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        // Fetch skin by username
        function fetchSkin() {
            const username = document.getElementById('username-input').value;
            if (!username) {
                alert("Please enter a Minecraft username.");
                return;
            }
            const img = new Image();
            img.onload = function() {
                const c = document.getElementById("myCanvas");
                c.width = img.width;
                c.height = img.height;
                c.getContext("2d").drawImage(img, 0, 0);
                test(img);
            };
            img.onerror = function() {
                alert("Could not find a skin for that username.");
            };
            // Use Minotar for direct skin image URL
            img.src = `https://minotar.net/skin/${username}`;
            img.crossOrigin = "anonymous";
        }

        // Download totem as a single image
        document.getElementById('image-download-btn').addEventListener('click', function() {
            const outputCanvas = document.getElementById("output-canvas");
            const link = document.createElement('a');
            link.href = outputCanvas.toDataURL('image/png');
            link.download = 'totem.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Download as a resource pack
        document.getElementById('pack-download-btn').addEventListener('click', function() {
            const outputCanvas = document.getElementById("output-canvas");
            const totemDataURL = outputCanvas.toDataURL('image/png');
            const username = document.getElementById('username-input').value || "Custom";
            
            const zip = new JSZip();
            
            // pack.mcmeta file
            const packMcmeta = {
                "pack": {
                    "pack_format": 1,
                    "supported_formats": { "min_inclusive": 1, "max_inclusive": 100 },
                    "description": "§7Custom Java §cTotem of Undying§7 Pack!"
                }
            };
            zip.file("pack.mcmeta", JSON.stringify(packMcmeta, null, 4));
            
            // pack.png file (using the totem image)
            zip.file("pack.png", totemDataURL.substr(totemDataURL.indexOf(',') + 1), { base64: true });
            
            // totem of undying texture
            const texturesFolder = zip.folder("assets/minecraft/textures/item");
            texturesFolder.file("totem_of_undying.png", totemDataURL.substr(totemDataURL.indexOf(',') + 1), { base64: true });
            
            // Generate and download the zip file
            zip.generateAsync({ type: "blob" }).then(function(content) {
                saveAs(content, `${username}-Totem.zip`);
            });
        });
    </script>
</body>
</html>
