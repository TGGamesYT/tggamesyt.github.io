<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TG's Discord Servers</title>

<!-- Open Graph / Discord Embed -->
<meta property="og:title" content="TG's Discord Servers">
<meta property="og:description" content="This is TG's discord servers and other servers he likes">
<meta property="og:image" content="https://tggamesyt.dev/assets/discord.jpg">
<meta property="og:type" content="website">
<meta name="theme-color" content="#5865F2">

<!-- Favicon -->
<link rel="icon" href="https://tggamesyt.dev/assets/discord.jpg">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg: #1e1f22;
  --card: #2b2d31;
  --muted: #b5bac1;
  --text: #ffffff;
  --accent: #23a559;
}

* {
  box-sizing: border-box;
  font-family: "Segoe UI", system-ui, sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
}

h1 {
  text-align: center;
  padding: 20px;
}

.category {
  margin: 20px;
}

.category h2 {
  color: var(--muted);
  border-bottom: 1px solid #3f4147;
  padding-bottom: 6px;
}

/* === CARD === */
.server {
  background: var(--card);
  border-radius: 18px;
  margin-top: 18px;
  overflow: hidden;
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
}

.banner {
  height: 110px;
  background-size: cover;
  background-position: center;
}

.server-body {
  padding: 48px 16px 16px;
  position: relative;
}

/* Icon overlaps banner seam */
.icon {
  position: absolute;
  top: -32px;
  left: 16px;
  width: 64px;
  height: 64px;
  border-radius: 18px;
  background-size: cover;
  background-position: center;
  border: 6px solid var(--card);
}

.info h3 {
  margin: 0;
  font-size: 20px;
}

.info p {
  margin: 6px 0;
  color: var(--muted);
  font-size: 14px;
}

.stats {
  margin-top: 6px;
  font-size: 14px;
  color: var(--muted);
}

.stats span {
  margin-right: 14px;
}

.stats .online {
  color: #23a559;
}

.join {
  margin-top: 16px;
}

.join a {
  display: block;
  width: 100%;
  text-align: center;
  background: var(--accent);
  color: white;
  text-decoration: none;
  padding: 14px;
  border-radius: 999px;
  font-weight: 700;
  font-size: 16px;
}

@media (min-width: 700px) {
  .server {
    max-width: 600px;
  }
}
</style>
</head>
<body>

<h1>Discord Servers</h1>
<div id="content"></div>

<script>
// === INVITE JSON ===
const INVITES = {
  "My servers": {
    "tg": "8v6NvACFX5",
    "redstone": "eH4ZyUVfpr",
    "hytale": "Qzfq4XAsx4"
  },
  "Favourite servers": {
    "icebluebird": "icebluebird",
    "peutron": "MrcrsKPJgR",
    "flashz": "axxMspEwfP",
    "mrbeastgaming": "mrbeastgaming",
    "kasaisora": "kasaisora",
    "locksoul": "rnJEQEArt3"
  }
};

// === UTILITIES ===
function shorten(num) {
  if (num < 1000) return num;
  if (num < 1e6) return (num / 1e3).toFixed(1).replace(/\.0$/, "") + "K";
  return (num / 1e6).toFixed(1).replace(/\.0$/, "") + "M";
}

function extractVibrantColor(img) {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = canvas.height = 32;
  ctx.drawImage(img, 0, 0, 32, 32);

  const data = ctx.getImageData(0, 0, 32, 32).data;
  let r = 0, g = 0, b = 0, count = 0;

  for (let i = 0; i < data.length; i += 4) {
    if (data[i + 3] > 200) {
      r += data[i];
      g += data[i + 1];
      b += data[i + 2];
      count++;
    }
  }

  return `rgb(${Math.round(r / count)}, ${Math.round(g / count)}, ${Math.round(b / count)})`;
}

// === SHORTCUT HANDLER ===
const shortcut = location.search.replace("?", "");
if (shortcut) {
  for (const group of Object.values(INVITES)) {
    if (group[shortcut]) {
      location.href = "https://discord.gg/" + group[shortcut];
    }
  }
}

// === FETCH + RENDER ===
const container = document.getElementById("content");

async function loadInvite(code) {
  const res = await fetch(
    `https://discord.com/api/v10/invites/${code}?with_counts=true`
  );
  if (!res.ok) return null;
  return res.json();
}

(async () => {
  for (const [groupName, servers] of Object.entries(INVITES)) {
    const cat = document.createElement("div");
    cat.className = "category";
    cat.innerHTML = `<h2>${groupName}</h2>`;
    container.appendChild(cat);

    for (const code of Object.values(servers)) {
      const data = await loadInvite(code);
      if (!data || !data.guild) continue;

      const iconUrl = data.guild.icon
        ? `https://cdn.discordapp.com/icons/${data.guild.id}/${data.guild.icon}.png?size=128`
        : "";

      const bannerUrl = data.guild.banner
        ? `https://cdn.discordapp.com/banners/${data.guild.id}/${data.guild.banner}.png?size=600`
        : "";

      const el = document.createElement("div");
      el.className = "server";

      const bannerEl = document.createElement("div");
      bannerEl.className = "banner";

      if (bannerUrl) {
        bannerEl.style.backgroundImage = `url('${bannerUrl}')`;
      }

      const body = document.createElement("div");
      body.className = "server-body";

      body.innerHTML = `
        <div class="icon" style="background-image:url('${iconUrl}')"></div>
        <div class="info">
          <h3>${data.guild.name}</h3>
          ${data.guild.description ? `<p>${data.guild.description}</p>` : ""}
          <div class="stats">
            <span class="online">● ${shorten(data.approximate_presence_count ?? 0)} Online</span>
            <span>● ${shorten(data.approximate_member_count)} Members</span>
          </div>
        </div>
        <div class="join">
          <a href="https://discord.gg/${code}">Join</a>
        </div>
      `;

      el.appendChild(bannerEl);
      el.appendChild(body);
      cat.appendChild(el);

      // Generate gradient if no banner
      if (!bannerUrl && iconUrl) {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.src = iconUrl;
        img.onload = () => {
          const color = extractVibrantColor(img);
          bannerEl.style.background = `linear-gradient(135deg, ${color}, rgba(0,0,0,0.6))`;
        };
      }
    }
  }
})();
</script>

</body>
</html>
