<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clicky Thing</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 100px; }
    button { font-size: 2rem; padding: 20px 40px; cursor: pointer; }
    #inputBox { display: none; margin-top: 20px; }
  </style>
</head>
<body>
  <h1 id="message">Click the button ðŸ‘‡</h1>
  <div id="numberDisplay"></div>
  <button id="clickBtn">Click Me</button>
  <div id="inputBox">
    <input type="text" id="secretInput" placeholder="Enter secret...">
    <button id="submitInput">Submit</button>
  </div>

  <script>
    // --- Simple seeded RNG (LCG) ---
    function mulberry32(seed) {
      return function() {
        let t = seed += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      }
    }

    const phrases = Array.from({length: 100}, (_, i) => `Wow this must be the last one (#${i})`);

    // Persistent state
    const seed = 12345; // fixed seed for consistent sequence
    const rng = mulberry32(seed);
    let usedNumbers = JSON.parse(localStorage.getItem("usedNumbers") || "[]");

    // Pick the next unique number from RNG
    function nextUniqueNumber() {
      let candidate;
      do {
        candidate = Math.floor(rng() * 100000000); // 0 - 99,999,999
      } while (usedNumbers.includes(candidate));
      usedNumbers.push(candidate);
      localStorage.setItem("usedNumbers", JSON.stringify(usedNumbers));
      return candidate;
    }

    // Get current number (resume from storage or start fresh)
    let num;
    if (usedNumbers.length > 0) {
      num = usedNumbers[usedNumbers.length - 1];
    } else {
      num = nextUniqueNumber();
    }

    // Display
    document.getElementById("numberDisplay").textContent = `Number: ${num}`;
    document.getElementById("message").textContent = phrases[num % phrases.length];

    const btn = document.getElementById("clickBtn");
    let holdTimer;

    btn.addEventListener("click", () => {
      num = nextUniqueNumber();
      document.getElementById("numberDisplay").textContent = `Number: ${num}`;
      document.getElementById("message").textContent = phrases[num % phrases.length];
      checkEasterEgg(num);
    });

    btn.addEventListener("mousedown", () => {
      if (num === 69) {
        holdTimer = setTimeout(() => {
          alert("ðŸ¤¨");
        }, 69000);
      }
    });
    btn.addEventListener("mouseup", () => clearTimeout(holdTimer));

    // ---- AES-GCM Decryption Helper ----
    async function deriveKey(password, salt) {
      const enc = new TextEncoder();
      const keyMaterial = await crypto.subtle.importKey(
        "raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]
      );
      return crypto.subtle.deriveKey(
        { name: "PBKDF2", salt, iterations: 100000, hash: "SHA-256" },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
      );
    }

    async function decrypt(ciphertextBase64, password, ivBase64, saltBase64) {
      try {
        const ciphertext = Uint8Array.from(atob(ciphertextBase64), c => c.charCodeAt(0));
        const iv = Uint8Array.from(atob(ivBase64), c => c.charCodeAt(0));
        const salt = Uint8Array.from(atob(saltBase64), c => c.charCodeAt(0));

        const key = await deriveKey(password, salt);
        const plaintextBuffer = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
        return new TextDecoder().decode(plaintextBuffer);
      } catch {
        return null;
      }
    }

    // --- Easter eggs handler ---
    function checkEasterEgg(n) {
      // Special case 2008
      if (n === 2008) {
        document.getElementById("inputBox").style.display = "block";
        document.getElementById("submitInput").onclick = async () => {
          const val = document.getElementById("secretInput").value;

          const ciphertext = "YUp4hktVjUG4qDlNTw4pU58C1qmvvWOO9iJmNX5JaRNhYpjcP0DFtMWmlpM=";
          const iv = "uwFtvcRXXnQIK4J3"; 
          const salt = "k2woGQ1Fnu7ox3k5qlcATA=="; 

          const result = await decrypt(ciphertext, val, iv, salt);
          if (result) {
            location.href = result;
          } else {
            document.getElementById("secretInput").value = "";
            num = nextUniqueNumber();
            document.getElementById("numberDisplay").textContent = `Number: ${num}`;
            document.getElementById("message").textContent = phrases[num % phrases.length];
            checkEasterEgg(num);
          }
        };
      }
    }

    // Check first number right away
    checkEasterEgg(num);
  </script>
</body>
</html>
