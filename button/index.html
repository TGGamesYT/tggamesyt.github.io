<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clicky Thing</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 100px; }
    button { font-size: 2rem; padding: 20px 40px; cursor: pointer; }
    #inputBox { display: none; margin-top: 20px; }
  </style>
</head>
<body>
  <h1 id="message">Click the button ðŸ‘‡</h1>
  <button id="clickBtn">Click Me</button>
  <div id="inputBox">
    <input type="text" id="secretInput" placeholder="Enter secret...">
    <button id="submitInput">Submit</button>
  </div>

  <script>
    // --- Simple seeded RNG (LCG) ---
    function mulberry32(seed) {
      return function() {
        let t = seed += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      }
    }

    const phrases = Array.from({length: 100}, (_, i) => `Wow this must be the last one (#${i})`);

    const params = new URLSearchParams(location.search);
    let num = parseInt(params.get("num")) || 0;

    const rng = mulberry32(num);
    const phrase = phrases[Math.floor(rng() * phrases.length)];
    if (num > 0) document.getElementById("message").textContent = phrase;

    const btn = document.getElementById("clickBtn");
    let holdTimer;

    btn.addEventListener("click", () => {
      num++;
      location.href = "?num=" + num;
    });

    btn.addEventListener("mousedown", () => {
      if (num === 69) {
        holdTimer = setTimeout(() => {
          alert("ðŸ¤¨");
        }, 69000);
      }
    });
    btn.addEventListener("mouseup", () => clearTimeout(holdTimer));

    // ---- AES-GCM Decryption Helper ----
    async function deriveKey(password, salt) {
      const enc = new TextEncoder();
      const keyMaterial = await crypto.subtle.importKey(
        "raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveKey"]
      );
      return crypto.subtle.deriveKey(
        { name: "PBKDF2", salt, iterations: 100000, hash: "SHA-256" },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
      );
    }

    async function decrypt(ciphertextBase64, password, ivBase64, saltBase64) {
      try {
        const enc = new TextEncoder();
        const ciphertext = Uint8Array.from(atob(ciphertextBase64), c => c.charCodeAt(0));
        const iv = Uint8Array.from(atob(ivBase64), c => c.charCodeAt(0));
        const salt = Uint8Array.from(atob(saltBase64), c => c.charCodeAt(0));

        const key = await deriveKey(password, salt);
        const plaintextBuffer = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ciphertext);
        return new TextDecoder().decode(plaintextBuffer);
      } catch {
        return null; // wrong password or tampered ciphertext
      }
    }

    // --- Easter egg for 2008 ---
    if (num === 2008) {
      document.getElementById("inputBox").style.display = "block";
      document.getElementById("submitInput").addEventListener("click", async () => {
        const val = document.getElementById("secretInput").value;

        const ciphertext = "sILM5+TR6FdihE0GMuFwIT7D8pQhO3sD4BdgDXOHiwk=";
        const iv = "O/0fV5C8h1nG5Zo2gwgZpg=="; 
        const salt = "Jt7tQCY6rP5W4YOnXyQbKg=="; 

        const result = await decrypt(ciphertext, val, iv, salt);
        if (result) {
          location.href = result;
        } else {
          alert("Nothing happens...");
        }
      });
    }
  </script>
</body>
</html>
